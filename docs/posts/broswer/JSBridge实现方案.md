---
title: JSBridge原理
---

## 用途

- 简单来说，JSBridge就是用来为 `JavaScript` 提供调用 `客户端功能` 的接口。
- 更全面的来说，JSBridge是一个桥梁，是`客户端` 和 `非客户端` 之间双向通信的通道。
- 这里所说的双向通信指的是
  - JS向客户端发送消息：调用客户端方法；通知客户端当前的JS相关的状态；
  - 客户端向JS发送消息：回溯调用结果，消息推送；通知JS当前客户端相关的状态；

## 原理

- 可以用`客户端`与`服务端`的交互模型来类比 `JavaScript` 和 `Native`之间的通信。

### 通信原理

`JavaScript`调用`Native`的方式主要有两种，`注入API` 和 `拦截 URL SCHEMA`

#### 注入API

- `注入API`的主要原理是，`Native` 通过 `webview` 提供的接口， 直接向`JavaScript`的执行上下文对象（window）中注入对象或者方法，让`JavaScript`在调用的时候，直接去执行`Native`注入的代码。

- 优点：对于前端来说使用方便

- 缺点：在 `Android 4.2` 以前的版本中的 `AddJavascriptInterface` 存在安全漏洞；在`4.2`版本之后，采用了 `@JavascriptInterface`接口。所以在安卓端存在兼容性问题。

#### 拦截 URL SCHEMA

- 前提：由于JS相对于客户端来说，是运行在一个独立的上下文中的，所以可以把`H5`与 `客户端`之间的通信理解为`客户端`与`服务端`之间的通信。两种方式都需要通过 `请求/响应` 进行交互。

- 客户端先定义一个`URL SCHEMA`，当前端去请求携带这个`URL SCHEMA`的地址时，这个请求会被客户端进行拦截，并根据这个请求的内容执行响应的操作。一般情况下，前端通常会采用访问`iframe`的方式发出请求，但是这种方式存在`请求长度限制`的问题；所以也可以采用`ajax`的请求方式发出请求。（但是`iOS`的`UIWebView`不支持这种方式）。

- 当然也可以通过访问 `location` 的方式去发出请求，但是在多次连续访问`location`的情况下，请求本身可能会丢失。
